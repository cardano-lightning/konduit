use aiken/crypto.{VerificationKey}
use konduit/types.{Locked, Squash, Tag}
use konduit/wellformed.{wellsigned}

// Test data generated by js code

type SigningKeytag {
  signing_key: ByteArray,
  verification_key: VerificationKey,
  tag: Tag,
}

type TestSquash {
  signing_keytag: SigningKeytag,
  squash: Squash,
}

type TestCheque {
  signing_keytag: SigningKeytag,
  cheque: Locked,
}

const s0 =
  TestSquash {
    signing_keytag: SigningKeytag {
      signing_key: #"3833fdd84a7c7d362a652c73ee8dfa1351ce7ae505c3e4f404d22dba711f8a82",
      verification_key: #"8c49822fd0f6158d8e357fe9d6fb009c075db4f8756ef082bd2e578e3601aa05",
      tag: #"245138c905599c8579ab186fbdbd6e62",
    },
    squash: (
      (1122952821, 1842963937, [697369812, 715828326, 1104206060]),
      #"56a818653fed84e3d7c3c2fcc2d3d0bdce43d6c8dc42935dc1d021bf9b5abee07c690f9bc39ba923660ee38b02b2d7721d4ea6703c7aa49e5a8ad68accc8820b",
    ),
  }

const c0 =
  TestCheque {
    signing_keytag: SigningKeytag {
      signing_key: #"7cceb657415fe4a6f4651a8979c03029ad987d7fce030f99d442a56675cd05e0",
      verification_key: #"e12c4a32ed7a6dba9e0b2018f49d99b3562fea8b2b9017553bfd043445c91625",
      tag: #"8c8806c0ddc26a41ef791754e76c5dbf",
    },
    cheque: (
      (
        1599641399,
        1454635506,
        1817569035,
        #"cd4c6946d549121059cf484ff6b558a0427a5438d18ca5a8b7022d7f6a153e3e",
      ),
      #"1effa5a8405cac3e92649a849759bb701e2f0c7af59ebbd3d5bd2ca24ffc32a3f9732ce2b3f53e2f7590ed78511b061e87a2f1685f4f3ab6a6e7c34af4a7a90e",
    ),
  }

const s1 =
  TestSquash {
    signing_keytag: SigningKeytag {
      signing_key: #"3833fdd84a7c7d362a652c73ee8dfa1351ce7ae505c3e4f404d22dba711f8a82",
      verification_key: #"8c49822fd0f6158d8e357fe9d6fb009c075db4f8756ef082bd2e578e3601aa05",
      tag: #"245138c905599c8579ab186fbdbd6e62",
    },
    squash: (
      (1122952821, 1842963937, [697369812, 715828326, 1104206060]),
      #"56a818653fed84e3d7c3c2fcc2d3d0bdce43d6c8dc42935dc1d021bf9b5abee07c690f9bc39ba923660ee38b02b2d7721d4ea6703c7aa49e5a8ad68accc8820b",
    ),
  }

const c1 =
  TestCheque {
    signing_keytag: SigningKeytag {
      signing_key: #"7cceb657415fe4a6f4651a8979c03029ad987d7fce030f99d442a56675cd05e0",
      verification_key: #"e12c4a32ed7a6dba9e0b2018f49d99b3562fea8b2b9017553bfd043445c91625",
      tag: #"8c8806c0ddc26a41ef791754e76c5dbf",
    },
    cheque: (
      (
        1599641399,
        1454635506,
        1817569035,
        #"cd4c6946d549121059cf484ff6b558a0427a5438d18ca5a8b7022d7f6a153e3e",
      ),
      #"1effa5a8405cac3e92649a849759bb701e2f0c7af59ebbd3d5bd2ca24ffc32a3f9732ce2b3f53e2f7590ed78511b061e87a2f1685f4f3ab6a6e7c34af4a7a90e",
    ),
  }

fn test_cheque(x: TestCheque) {
  wellsigned(
    x.signing_keytag.verification_key,
    x.signing_keytag.tag,
    x.cheque.1st,
    x.cheque.2nd,
  )
}

test test_c0() {
  test_cheque(c0)
}

test test_c1() {
  test_cheque(c1)
}

fn test_squash(x: TestSquash) {
  wellsigned(
    x.signing_keytag.verification_key,
    x.signing_keytag.tag,
    x.squash.1st,
    x.squash.2nd,
  )
}

test test_s0() {
  test_squash(s0)
}

test test_s1() {
  test_squash(s1)
}
